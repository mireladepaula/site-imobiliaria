<!DOCTYPE html>
<html>
    <head>
        <title>[config_site_title] | Painel Administrativo</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />

        <script src="js/jquery/jquery-1.8.3.min.js" type="text/javascript"></script>

        <script src="js/jquery/bootstrap/bootstrap.js" type="text/javascript"></script>
        <script src="js/jquery/stupidtable.js" type="text/javascript"></script>

        <script src="js/jquery/jquery-ui-1.9.2.js" type="text/javascript"></script>
        <link rel="stylesheet" href="http://code.jquery.com/ui/1.9.1/themes/base/jquery-ui.css" /> 

        <link href="js/jquery/bootstrap/bootstrap.css" rel="stylesheet" />
        <link href="js/jquery/bootstrap/bootstrap-responsive.css" rel="stylesheet" />

        <link href="css/admin/main.css" rel="stylesheet" />
        <script src="js/admin/main.js" type="text/javascript"></script>
        <script src="js/admin/item.js" type="text/javascript"></script>

 <!--
    <script src="https://rawgit.com/enyo/dropzone/master/dist/dropzone.js"></script>
    <link rel="stylesheet" href="https://rawgit.com/enyo/dropzone/master/dist/dropzone.css">
  -->
  <script src="js/jquery/dropzone-master/dist/dropzone.js"></script>
  <link rel="stylesheet" href="js/jquery/dropzone-master/dist/dropzone.css">


        <style>
            .panel .add-on{min-width: 150px;}
            #modal-dono .add-on{min-width: 120px; text-align: right}
        </style>

    </head>
    <body>
        <div class="container" id="main">
            <div class="row-fluid">
                <div id="top"><h1>[config_site_title] | Painel Administrativo</h1></div>
            </div>

            <div class="row-fluid">
                <div class="span12 bar">
                    <div class="span3"></div>
                    <div class="span9">
                        <div class="pull-right btn-toolbar" style="margin: 0;margin-top:7px;">
                            <div class="btn-group dropdown">
                                <button class="btn-mini btn primary btn-inverse"> <i class="icon icon-user icon-white"></i> [user_name]</button>
                                <button class="btn-mini btn primary btn-inverse dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
                                <ul class="dropdown-menu pull-right">
                                    <li><a href="[baseUri]/admin/usuario/me/" style="font-size: 9px;">Meus Dados</a></li>
                                    <li><a href="[baseUri]/admin/login/logout/" style="font-size: 9px;">Logout</a></li>
                                </ul>
                            </div>
                        </div>  
                    </div>
                </div>
            </div>

            <div class="row-fluid">

		<?php include 'menu.html'; ?>               

                <div class="span9" id="right">
                    <div class="row-fluid">

                        <div class="panel">
                            <div class="title-grid-inverse">
                                <i class="icon-edit icon-white"></i>  <b>Editar - REF. [item_ref]</b>
                            </div>
                        </div>


                        <div class="panel">
                            <ul class="nav nav-tabs myTaber" id="myTab">
                                <li class="active"><a href="#dados">Dados</a></li>
                                <li><a href="#precos">Valores</a></li>
                                <li><a href="#exibe">Exibição</a></li>
                                <li><a href="#desc">Descrição</a></li>
                                <li><a href="#fotos">Fotos</a></li>
                                <li><a href="#proprietario">Proprietário</a></li>
                                <li><a href="javascript:void(0)" id="btn-add" class="tab-update">Atualizar</a></li>
                            </ul>
                            <form name="f-item" id="f-item" class="form mar-top-10" method="post" 
                                  onSubmit="return valida()" action="[baseUri]/admin/item/atualizar/[item_id]/">

                                <div class="tab-content myTaber-content">
                                    <div class="tab-pane active" id="dados">
                                        <br />
                                        <div class="input-prepend">
                                            <span class="add-on">Código do Imóvel: </span>
                                            
                                            <input class="span6" name="item_ref" id="item_ref" type="text" value="[item_ref]" maxlength="15"
                                                   placeholder="AP007" />
                                            
                                        </div>

                                        <div class="input-prepend">
                                            <span class="add-on">Finalidade: </span>
                                            <select name="item_finalidade" id="item_finalidade" class="span6">
                                                <option value="1" selected>Venda</option>
                                                <option value="2">Locação</option>
                                                <option value="3">Locação e Venda</option>
                                                <option value="4">Temporada</option>
                                            </select>
                                        </div>

                                        <div class="input-prepend">
                                            <span class="add-on">Tipo Imóvel: </span>
                                            <select name="item_tipo" id="item_tipo" class="span6">
                                                <option value="">Selecione um tipo de imóvel</option>
                                                <!--{loop:tp}-->
                                                <!--{<option value="tp.tipo_id">tp.tipo_title</option>}-->
                                                <!--{end:tp}-->
                                            </select>
                                        </div>

                                        <div class="input-prepend">
                                            <span class="add-on">Cidade: </span>
                                            <select name="item_categoria" id="item_categoria" class="span6">
                                                <!--{loop:combo}-->
                                                <!--{<option value="combo.categoria_id">combo.categoria_title</option>}-->
                                                <!--{end:combo}-->
                                            </select>
                                        </div>

                                        <div class="input-prepend">
                                            <span class="add-on">Bairro: </span>
                                            <select name="item_sub" id="item_sub" class="span6"></select>
                                        </div>

                                        <div class="input-prepend">
                                            <span class="add-on">Endereço: </span>
                                            <input class="span6" name="item_endereco" id="item_endereco" type="text" value="[item_endereco]"
                                                   placeholder="Av. Paulista, 500" />
                                        </div>                                            


                                        <div class="input-prepend">
                                            <span class="add-on">Dormitórios: </span>
                                            <select name="item_dorm" id="item_dorm" class="span6">
                                                <option value="0">0</option>
                                                <option value="1" selected>1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                                <option value="10">10</option>
                                                <option value="11">11</option>
                                                <option value="12">12</option>
                                                <option value="13">Mais de 12</option>
                                            </select>
                                        </div>
                                        <div class="input-prepend">
                                            <span class="add-on">Banheiros: </span>
                                            <select name="item_wc" id="item_wc" class="span6">
                                                <option value="0">0</option>
                                                <option value="1" selected>1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                                <option value="10">10</option>
                                                <option value="11">11</option>
                                                <option value="12">12</option>
                                                <option value="13">Mais de 12</option>
                                            </select>
                                        </div>
                                        <div class="input-prepend">
                                            <span class="add-on">Suítes: </span>
                                            <select name="item_suite" id="item_suite" class="span6">
                                                <option value="0">0</option>
                                                <option value="1" selected>1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                                <option value="10">10</option>
                                                <option value="11">11</option>
                                                <option value="12">12</option>
                                                <option value="13">Mais de 12</option>
                                            </select>
                                        </div>
                                        <div class="input-prepend">
                                            <span class="add-on">Vagas (garagem): </span>
                                            <select name="item_vaga" id="item_vaga" class="span6">
                                                <option value="0">0</option>
                                                <option value="1" selected>1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                                <option value="10">10</option>
                                                <option value="11">11</option>
                                                <option value="12">12</option>
                                                <option value="13">Mais de 12</option>
                                            </select>
                                        </div>

                                        <div class="input-prepend">
                                            <span class="add-on">Área em M²: </span>
                                            <input class="span6 numeric" name="item_area" id="item_area" type="text" value="[item_area]"
                                                   placeholder="Área do imóvel ex: 300" />
                                        </div>                                            

                                    </div>

                                    <div class="tab-pane" id="precos" style="height: 470px;">
                                        <br />


                                        <div class="input-prepend">
                                            <span class="add-on">Valor Venda R$: </span>
                                            <input class="span6 valor" name="item_preco" id="item_preco" type="text" value="[item_preco]"
                                                   placeholder="Valor de venda do imóvel" />
                                        </div>

                                        <div class="input-prepend">
                                            <span class="add-on">Valor Locação. R$: </span>
                                            <input class="span6 valor" name="item_preco_locacao" id="item_preco_locacao" value="[item_preco_locacao]"
                                                   type="text" placeholder="Valor mensal de locação " />
                                        </div>

                                        <div class="input-prepend">
                                            <span class="add-on">Valor Temporada (diária) R$: </span>
                                            <input class="span6 valor" name="item_preco_temp" id="item_preco_locacao" value="[item_preco_temp]"
                                                   type="text" placeholder="Valor da diária para temporada" />
                                        </div>

                                        <div class="input-prepend">
                                            <span class="add-on">Valor Condomínio R$: </span>
                                            <input class="span6 valor" name="item_preco_condominio" id="item_preco_condominio" value="[item_preco_condominio]"
                                                   type="text" placeholder="Valor mensal de condomínio" />
                                        </div>

                                        <div class="input-prepend">
                                            <span class="add-on">Valor IPTU R$: </span>
                                            <input class="span6 valor" name="item_preco_iptu" id="item_preco_iptu" value="[item_preco_iptu]"
                                                   type="text" placeholder="Valor mensal de IPTU" />
                                        </div>

                                    </div>

                                    <div class="tab-pane" id="exibe" style="height: 470px;">
                                        <br />

                                        <div class="input-prepend">
                                            <span class="add-on">Imóvel Ativo: </span>
                                            <select name="item_show" id="item_show" class="span6">
                                                <option value="0">Não</option>
                                                <option value="1" selected>Sim</option>
                                            </select>
                                        </div>

                                        <div class="input-prepend" id="rotulo">
                                            <span class="add-on">Rótulo / Vendido / Alugado: </span>
                                            <select name="item_vendido" id="item_vendido" class="span6">
                                                <option value="0">Nenhum</option>
                                                <option value="1">Vendido</option>
                                                <option value="2">Alugado</option>
                                                <option value="3">Lançamento</option>
                                                <option value="4">Pronto para Morar</option>
                                                <option value="5">Em Construção</option>
                                                <option value="6">Oportunidade</option>
                                                <option value="7">Financie</option>
                                                <option value="8">Decorado</option>
                                                <option value="9">Para Renda</option>
                                                <option value="10">Alugue</option>
                                                <option value="11">Condominio</option>
                                                <option value="12">Cobertura</option>
                                                <!--<option value="x">Rótulo Personalizado</option> -->
                                            </select>
                                        </div>

                                        <div class="input-prepend">
                                            <span class="add-on">Imóvel em Destaque: </span>
                                            <select name="item_destaque" id="item_destaque" class="span6">
                                                <option value="0">Não</option>
                                                <option value="1">Sim</option>
                                            </select>
                                        </div>

                                        <div class="input-prepend">
                                            <span class="add-on">Imóvel no Slideshow: </span>
                                            <select name="item_slide" id="item_slide" class="span6">
                                                <option value="0">Não</option>
                                                <option value="1">Sim</option>
                                            </select>
                                        </div>                                        
<!--
                                        <div class="input-prepend">
                                            <span class="add-on">Endereço exato no Mapa: </span>
                                            <select name="item_mapa" id="item_mapa" class="span6">
                                                <option value="1">Não</option>
                                                <option value="2">Sim</option>
                                            </select>
                                        </div>                                        
                                        
                                        <div class="input-prepend">
                                            <span class="add-on">Latitude: </span>
                                            <input id="item_lat" name="item_lat" type="text" class="span6" value="[item_lat]"/>
                                        </div>                                        

                                        <div class="input-prepend">
                                            <span class="add-on">Longitude: </span>
                                            <input id="item_lat" name="item_lon" type="text" class="span6" value="[item_lon]"/>
                                        </div>  
                                        -->
                                    </div>

                                    <div class="tab-pane" id="desc" style="height: 470px;">
                                        <br />
                                        [editor]                                      
                                    </div>

										<div class="tab-pane" id="fotos" style="margin-right:10px">

											<div id="dropzone" style="margin-top:20px;">
												<div action="[baseUri]/admin/uploadr/[item_id]/" class="dropzone needsclick" styles="margin-top:20px;background: url([baseUri]/app/images/icons/uploadr.png); background-position: center center; background-repeat: no-repeat" id="foto-upload">
													<div class="dz-message needsclick">
													<h5 style="font-size: 1.7em">
													Arraste as fotos aqui ou clique para selecionar
													<br/>
													</h5>
													</div>
												</div>
										</div>


									<span class="btn-upload offset1">
                                    <br/>
                                    <br/>
                                    <p class="well well-small">
                                    <i class="icon-info-sign"></i>
                                    Para selecionar fotos para remover, use o duplo clique.<br/>
                                    </p>
                                  
									<div class="row">
                                    <span class="pull-right" id="foto-control" style="margin-right: 25px">
                                                    <button id="btn-remove-all" class="btn btn-mini btn-inverse"><i
                                                            class="icon-check icon-white"></i> selecionar todas</button> &nbsp;
                                                    <button id="btn-remove-cancel" class="btn btn-mini btn-inverse"><i
                                                            class="icon-refresh icon-white"></i> cancelar seleção</button> &nbsp;
                                                    <button id="btn-remove-foto" class="btn btn-mini btn-danger"><i
                                                            class="icon-trash icon-white"></i> remover selecionadas</button>
                                     </span>
									</div>
                <div class="photo-gallery">
                  <ul id="photo-gallery-ul">
					<!--{loop:ft}-->
                    <!--{<li class="tips-top ui-state-default" id="li_ft.foto_id"><img src="[baseUri]/thumb/ft.foto_url/130/100/" alt="" /></li>}-->
                    <!--{end:ft}-->
                                                </ul>
												
												
                                         </div>				
                                        </span>  

                                    </div>

                                    <div class="tab-pane" id="proprietario">
                                        <br />

                                        <p class="well well-small" style="width: 550px;"><b class="icon-folder-close"></b> Vincular Proprietário</p>

                                        <div class="input-prepend">
                                            <span class="add-on">Proprietário do Imóvel: </span>
                                            <select name="item_dono" id="item_dono" class="span6">
                                                <option value="">Selecione um proprietário...</option>
                                                <!--{loop:dono}-->
                                                <!--{<option value="dono.dono_id">dono.dono_nome</option>}-->
                                                <!--{end:dono}-->
                                                <option value="n">Cadastrar novo proprietário...</option>
                                            </select>
                                        </div>      

                                    </div>

                                    <br />
                                </div>
                            </form> <!--{end form}-->
                        </div><!--{end panel}-->
                    </div>                    
                </div><!--end right-->  


                <div class="row-fluid">
                    <div class="span12 bar"></div>
                </div>           

                <div class="row-fluid">
                    <div id="footer"></div>
                </div>            
            </div><!--end row-fluid-->             
        </div> <!--end main-->

        <div class="modal hide fade" id="modal-remove">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h5><img src="images/icons/alert.png" /> Remover Subcategoria</h5>
            </div>
            <div class="modal-body">
                <p>Você está prestes a remover uma categoria e todos os seus itens!</p>
                <p>Deseja realmente prosseguir?</p>
            </div>
            <div class="modal-footer">
                <a href="javascript:void(0)" onclick="$('#modal-remove').modal('hide')" class="btn btn-small">Cancelar</a>
                <a href="javascript:void(0)" id="btn-remove" class="btn btn-small btn-danger">Confirmar Remoção</a>
            </div>
        </div>  

        <div class="modal hide fade" id="modal-dono">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h3><img src="images/icons/male.png" /> Cadastrar Proprietário</h3>
            </div>
            <div class="modal-body">
                <p>Cadastro Rápido de Proprietário</p>
                <p>Você poderá complementar o cadastro do proprietário posteriormente através do menu "proprietários".</p>
                <br />

                <form class="form" onsubmit="return false">
                    <div class="input-prepend">
                        <span class="add-on">Nome Completo: </span>
                        <input class="" name="dono_nome" id="dono_nome"  type="text" placeholder="Nome do proprietário" />
                    </div>                    
                    <div class="input-prepend">
                        <span class="add-on">Telefone: </span>
                        <input class="" name="dono_telefone1" id="dono_telefone1"  type="text" placeholder="Telefone principal" />
                    </div>                    
                </form>

            </div>
            <div class="modal-footer">
                <a href="javascript:void(0)" onclick="checkDonoAndClose()" class="btn btn-small">Cancelar</a>
                <a href="javascript:void(0)" id="btn-cadastra" class="btn btn-small btn-danger">Cadastrar</a>
            </div>
        </div>  


        <script type="text/javascript">
    Dropzone.autoDiscover = false;
    $("#foto-upload").dropzone({
      paramName: "Filedata",
      url: "[baseUri]/admin/uploadr/[item_id]/",
      //acceptedFiles: "image/jpeg,image/png,image/gif",
      accept: function(file, done) {
        //$("#btn-upload-complete").removeClass('hide').show();
        //console.log($('#foto_contrato').val())
        done();
      },
      //maxFilesize: 500000,
      complete: function(file) {
        var _this = this;
        if (this.getUploadingFiles().length === 0 && this.getQueuedFiles().length === 0) {
          //console.log('completou')
          setTimeout(function() {
            window.location = '[baseUri]/admin/item/editar/[item_id]/fotos/';
          }, 500)

        }
      },
      sending: function(file, xhr, formData) {
        formData.append("item_id", '[item_id]');
      },
      error: function(file, response) {
        //_alert_error(response)
        console.log(response)
      },
      success: function(file, response) {
        console.log(response)
      },
      totaluploadprogress: function() {
        //
      }
    });


    $(function() {
      $('#item_desc').redactor({
        focus: true,
        imageUpload: 'helpers/redactor/image_upload.php',
        fileUpload: 'helpers/redactor/file_upload.php',
        imageGetJson: 'helpers/redactor/json.php'
      });
      $('#myTab').tab();
      $('#myTab a').click(function(e) {
        e.preventDefault();
        $(this).tab('show');
      });
      [loadTab]
      //altura do editor
      $('#desc').height($(window).height() - 100);
      $('#item_desc').height($(window).height() - 250);
      $('#item_categoria').val('[item_categoria]');
      $('#item_oferta').val('[item_oferta]');
      $('#item_show').val('[item_show]');
      $('#item_peso').val('[item_peso]');
      $('#item_zoom').val('[item_zoom]');
      $('#item_parc').val('[item_parc]');
      $('#item_slide').val('[item_slide]');
      $('#item_calcula_frete').val('[item_calcula_frete]');
      $('#item_destaque').val('[item_destaque]');
      $('#item_categoria').val('[item_categoria]');
      $('#item_marca').val('[item_marca]');
      loadSub('[categoria_id]', '[item_sub]');

        $('#btn-add-rel').on('click', function () {
            var url = $('#item_relacionado').data('url');
            var produto_pai = '[item_id]';
            var produto_relacionado = $('#item_relacionado option:selected').val();


            if (produto_relacionado >= 1) {
                $.post(url, {
                    produto_pai: produto_pai,
                    produto_relacionado: produto_relacionado
                }, function (data) {
                    //notify('<h1>Atualizado</h1>');
                    window.location = baseUri + '/admin/item/editar/' + produto_pai + '/relacionado/';
                });
            }

        })

        //remove
        $('.removerel').live('click', function () {

            var relacionadoid = $(this).attr('id');
            var item_id = $(this).attr('item');

            $('#btn-confirmremoverel').attr('relacionadoid', relacionadoid);
            $('#btn-confirmremoverel').attr('item_id', item_id);
            $('#modal-removerel').modal('show');


        })
//remove
        $('#btn-confirmremoverel').live('click', function () {
            var relacionadoid = $(this).attr('relacionadoid');
            var item_id = $(this).attr('item_id');
            var url = baseUri + '/admin/item/removerprodutorelacionado/';
            $.post(url, {
                relacionadoid: relacionadoid,
                item_id: item_id
            }, function (data) {
                console.log(data);
                if (data != 'nope') {
                    notify('<h1>' + data + '!</h1>');
                    $('#modal-removerel').modal('hide');
                    $('#tr'+relacionadoid).remove();
                }
            })


        })

    });
    $("#menu-produto").addClass('active');
    $("#produto-editar").addClass('active');

    window.onload = function() {
      [msgOnload]
    }
  </script>
  
  

        <script>
            $(function(){
                //editor e tabs
                $('#item_desc').redactor();
                $('#myTab').tab();
                $('#myTab a').click(function (e) {
                    e.preventDefault();
                    $(this).tab('show');
                })  
                
                //$('#myTab a[href="#proprietario"]').tab('show');
                //$('#modal-dono').modal('show');
                
                [loadTab]
                //$('#myTab a[href="#profile"]').tab('show');
                $('#item_categoria').val('[item_categoria]');
                $('#item_vendido').val('[item_vendido]');
                $('#item_show').val('[item_show]');
                $('#item_finalidade').val('[item_finalidade]');
                $('#item_tipo').val('[item_tipo]');
                $('#item_dorm').val('[item_dorm]');
                $('#item_vaga').val('[item_vaga]');
                $('#item_suite').val('[item_suite]');
                $('#item_wc').val('[item_wc]');
                $('#item_destaque').val('[item_destaque]');
                $('#item_mapa').val('[item_mapa]');
                $('#item_slide').val('[item_slide]');
                $('#item_dono').val('[item_dono]');
                donoStart = $('#item_dono option:selected').val();
                loadSub('[categoria_id]','[item_sub]');   
				/*
                setTimeout(function(){
                    $('#item_sub').val('[item_sub]');
                },1000)
				*/
                //popr('btn-remove-all','aaa','','top');
            })
        </script>
        <script>
            window.onload = function(){
                [msgOnload]
            }
        </script>        
    </body>
</html>
